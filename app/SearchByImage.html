<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Image Search and Upload</title>
    <style>
        /* Basic styling */
        body {
            font-family: Arial, sans-serif;
            text-align: left;
            margin: 20px;
        }

        #thumbnails, #result {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .thumbnail, .uploaded-image {
            margin: 10px;
            border: 1px solid #ccc;
            padding: 10px;
        }

        .thumbnail img, .uploaded-image img {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>

<div>
    <a href="../index.html" >
        <img
                src="../img/FaviconSix.png"
                height="40"
                width="110"
        />
    </a>
</div>
<h1>Food Search By Image</h1>

<!-- Image Upload Section -->
<div>
    <h2>Image Upload For URL</h2>
    <input type="file" id="imageFile" name="imageFile">
    <button onclick="uploadImage()">Upload</button>
    <div id="result" class="uploaded-image"></div>
</div>

<!-- Image URL Search Section -->
<div>
    <h2>Image Search By URL</h2>
    <input type="text" id="imageUrl" placeholder="Enter Image URL">
    <button onclick="performSearch()">Search</button>
    <div id="thumbnails"></div>
</div>

<script>
    // Function to upload image and display result

    function uploadImage() {
    var formData = new FormData();
    var imageFile = document.getElementById("imageFile").files[0];
    formData.append("file", imageFile);

    fetch("https://upload-image-and-return-url-by-thichthicodeteam.p.rapidapi.com/api/upload-image", {
        method: "POST",
        headers: {
            "X-Rapidapi-Key": "f45a75ea1cmsh0dd1751d526138fp1f1ac1jsn1b2f727d5f7a",
            "X-Rapidapi-Host": "upload-image-and-return-url-by-thichthicodeteam.p.rapidapi.com",
            "Accept": "*/*"
        },
        body: formData
    })
    .then(response => response.json()) // Parse the response as JSON
    .then(data => {
        console.log(data);
        var imageUrl = data.link; // Extract the URL from the response
        document.getElementById("result").textContent = imageUrl;
        document.getElementById("imageUrl").value = imageUrl; // Set the uploaded image URL to the search field
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById("result").textContent = 'Error: ' + error;
    });
}



    // Function to display thumbnails from search
    function displayThumbnails(data) {
        const thumbnailsDiv = document.getElementById('thumbnails');
        thumbnailsDiv.innerHTML = ''; // Clear existing content

        data.visual_matches.forEach(item => {
            const thumbContainer = document.createElement('div');
            thumbContainer.className = 'thumbnail';

            const link = document.createElement('a');
            link.href = item.link; // Set the hyperlink to the item's link
            link.target = "_blank"; // Open in a new tab

            const image = document.createElement('img');
            image.src = item.thumbnail;
            image.alt = 'Thumbnail';

            link.appendChild(image); // Append the image to the link
            thumbContainer.appendChild(link); // Append the link to the thumbnail container

            if (item.title) {
                const title = document.createElement('p');
                title.textContent = item.title;
                thumbContainer.appendChild(title);
            }

            thumbnailsDiv.appendChild(thumbContainer);
        });
    }

    // Function to perform search based on image URL
    function performSearch() {
        const imageUrl = document.getElementById('imageUrl').value;
        if (imageUrl) {
            fetchJsonData(imageUrl);
        } else {
            alert('Please enter an image URL.');
        }
    }

    function fetchJsonData(imageUrl) {
        const encodedUrl = encodeURIComponent(imageUrl);

        fetch(`https://real-time-lens-data.p.rapidapi.com/search?url=${encodedUrl}&language=en&country=us`, {
            method: 'GET',
            headers: {
                'X-Rapidapi-Key': 'f45a75ea1cmsh0dd1751d526138fp1f1ac1jsn1b2f727d5f7a', // Replace with your API key
                'X-Rapidapi-Host': 'real-time-lens-data.p.rapidapi.com'
            }
        })
        .then(response => response.json())
        .then(data => {
            displayThumbnails(data.data);
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to fetch data. Please check the console for details.');
        });
    }
</script>
</body>
</html>
